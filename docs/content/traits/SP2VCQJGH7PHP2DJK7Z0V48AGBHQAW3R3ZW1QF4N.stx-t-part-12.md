---
title: "Trait stx-t-part-12"
draft: true
---
```
;; Used to simulate mainnet migration from v1 to v2 in the test suite
;; Must be called after deploying migrate-v0-v1.clar

(define-constant deployer tx-sender)

(define-data-var executed bool false)
(define-data-var executed-burn-mint bool false)
(define-data-var executed-reserve-data-update bool false)
(define-data-var executed-borrower-block-height bool false)
(define-data-var enabled bool true)

;; TODO: to fetch off-chain
(define-constant holders (list
 'SP30GF338DH3TTJA9GYCQZRQ50H78YXF670580KNK
 'SP30HDJ7J41H80WSM8F4QZ41V26D97P8PRGEEMSZA
 'SP325JCAZGDZNH5E83AQEDCD6CJ57765S4CN1HR0A
 'SP34B5WBMWK192FMSFCM19ZXBDQ3HCWYN8C2F0AGT
 'SP34Q00RYW4TRJFN80DSQHTFGMEJ0J3B77AJ5J3JQ
 'SP34SFTZ7TTRY3R1X8FY3V6FYFJYCFNT0G49Y253
 'SP374DSW0WMSNT5D43XYADMZE34EMY65BKNN7F3ZW
 'SP37BWJKFCBJHW7C3H522M03DCRJQ2NC492T4AMY9
 'SP3834V2V0ZJ1PAZ49NV74R1DXVPYPKWRD7K7GNNM
 'SP3A74M7AX67W64Y8SH1ARYC1K8ZM522QNBQKB7SZ
 'SP3BNDJMKKNV1VF80JGBN9SSTADE064NPGM47H3N
 'SP3CRRP9G32JZM6VBX893TDER9CA8914062G9J26W
 'SP3DZKT57VJMXQD50RXETPNZTR1Z6J4F8X7NQ0MH6
 'SP3EQX1Q52T9E5RBT2YYD4ATAA0VDDFXVJ15F551Q
 'SP3FW0KM9HVPBG6K1253WQTDZEX9PM0YA60Q9C8G3
 'SP3FZGQS4YTC87PSQGKY43RGSYX41APNM6VQ00SG5
 'SP3HKGB0BA8511HA1VRW1NZCEMKEC62C4EMZG8RNV
 'SP3HTFZ50KK0PFE27XA9V163SKQYPK4BB5K0DS4ZQ
 'SP3J3XP8TW2ENWZM3ZKDA3PFT46GSTZ3ZTTFSWZDK
 'SP3J9BFV82MDGAETV5ACJ07TYDJ8AMF4ZAH5K77J2
 'SP3K5Z7GSATTY2GZ8KEKAR9GF27DJ7NZBB7DRPJKS
 'SP3NW0JJZC3CE0DK125CY9DNH1AYWE31JMJQFJ2S9
 'SP3P4QWEYFT6K9K4F21HRT76GAFFEFGBPTJEZ28WW
 'SP3P8GFF3QH1ZQYHMAQ0777FT0Y89AWVDBH2K613A
 'SP3Q6PY2FSG4R8VS4HDGCEAYTFSJGAE8TR7NCAKBC
 'SP3SM4474JNFGSQXSDWY0JHJXX88SFFB4RMV7TQCT
 'SP3SV3J8EWBQJH45SAJ3VGHFDSZV0DEQXNAPFSVHQ
 'SP3TDK3HN90AV3K0CTEQTMJQTCAJSFTXV3BGHZRS3
 'SP3TEX5E4MM1TXXXBRWNZVBQ1S40S0FFQVTGHP53V
 'SP3W1JKRFG91FWKW1AFW0PHPAHFTAMV0022Q6KYJ4
 'SP3W8PC4J3G81ZEAE09V5CP88195V7AXCMPA0Z6CX
 'SP3WSGS0A7DM0K32X1RF1A8PM4KPQAY091FR8SRZ0
 'SP3Y50MB35S35Q3YKQ2AZNR1X0MFZ4NVR77AFJRHR
 'SP4ER4J5J5M90ABVHMTJTXBZSS1VN10XN84F4KVA
 'SP5FJ78KJKG1Z9J1AFVFQZPGQT1YX0DMAKYFXAJK
 'SP61M06Y60MHEM85SD3QA5Q83TNE97V9G12J5ENB
 'SP704XS7G4F277JB1A6Z8TJYGCX4T91CPA79VTFR
 'SP7HPQ7T421E4K8T86KX4TYF14M0SC2GYZSKH7RG
 'SP8VH92GXA0Y9STX8MQ4N03X9NAV3MJFZW8W0JT1
 'SPAM0THP35KFF9N1Z36J3E0WM2M64VP6AGCSHV8A
 'SPBPRAVHBMNYJBPDQ3G7DXRP3DTTYWDE8HN93DQJ
 'SPD3P1KHK4P7CFGJQ8EZ9FPQ0AJTKT1Y8T3WMRT8
 'SPECWWCDJ7CEHH28H8DYCQQC4V481AEVKPN3HV4Z
 'SPG5YFN72MPX5A3FS0BWAJZZ7JB5YCBBPNCFTH13
 'SPH1ZAHN998PFH9A2CBNQ5EM3HKXG08FA0CKF4MB
 'SPJWAV43BYCM47R21XNBCN005CBMTB0SZC8MS236
 'SPKS1G7EQHP6FCFPFQW9S1913EAHHGHX0493F14V
 'SPKYAKQS4ZEM6NXJP0F2JCX1D43AY7A6H6MV7ADP
 'SPNP59GEBBHZK7WKA5KEZ7C88Y63AKQAXG3EQ0KG
 'SPNRDJQJE1A8SPJ5KPZ2359JK5D32VCWY7648K61
 'SP1QPG35QKNXZR476A6KBQYCZS26C539K2GAB70DN
 'SPP3PXVCQJHHRHR56XR7EVS03M1A04HQDNAFHBTM
 'SPQ06KRSF2TBHXKPA3GSC1PMD23PP3KBNK2HF14
 'SPQKQFZDEGX6HG9ZKTVNTTJ40ZC2Y0TFQWN76KQS
 'SPS51PEXKRDZMR0NYPYMM1EH2Y054T3ND173N0NW
 'SPSQ4W56BY5XKZR8YJMXYP1CKJ64TT4CQ04GFQT8
 'SPT6FK75RFEEM99Q7AMZ90RT6N4CK46BN70YCCMC
 'SPTBHECD5EFPR9CJ06ZQ3VC0DQ9BCWWWTGE1XM84
 'SP28FVJEN5H117M5TPG168B3H95YKYHS16YZADT2Y
 'SPCWFA2MWWRMX71FWC67ENZC9KSGF1PW13B0NV23
 'SP2RHKTWVDV2MJ81TGZZPHS8PC67FCTTQF0CR368
 'SPP5616N643T2N9M6JWW0YXJ337JZTWZTDE2HK1T
 'SP1K0H4K40HGTM2BJQ8B7B1Z5EJVAPGCDDBC66YDP
 'SP1HWWBHN9TEG6EVK0XPS89FY44GGWF7AT9AMV2YF
 'SP1G7VTJ19H3BXV8XKKW508GKD9SR0163YV8GEKKJ
 'SPSVM4EVEX2AFJ1SKTGKCKAYPYZATFTJ45MQ3NGW
 'SP21YZBZ9W6CHCSVS6162Q9Q5TK40V0JYMKMS2JZJ
 'SPYF6S089X54MSEDMPMGX68BFVFB4WB0MN21XYDJ
 'SP10QN6WAXKSQ9YF8EA172EJMQYDFWFWB6V6GM9XP
 'SP1N8P16BN9VN4H6QY8NFVAMDZC51WSFC154VB6A7
 'SPAC1WCFDBSWV9MQRK8W6157GE6NCV1E775YFPT7
 'SP24SHTYAXX7XZYZ7ZAP2FA619NTMMN282XBM27SP
 'SP27EFB3DJE1MB9NQG8DCT1VAFBAP57VG4SZMC1BN
 'SP33CW3BKEENJW28XT0SQ3YCKG5FK1G3TX640MT0B
 'SP3KMJN27J1YGG7WD2484DCK12JB93GNDQBVWZKKR
 'SP11ES97SJQ4E4DYFYR50BRJH2MHQEHZA8YXZDQ2X
 'SP2K9K2NXF60ZZD3SH2WVAPJAVEHD6YC3CF9BX644
 'SP3JSV4YCPR7JSD4F440G2W0K256Q40CV67BHRD03
 'SP3Y6ADM24Z129CQXBNCN3A1MX5TTR4FDRTQD70G8
 'SP35FD2AKFGKH6PTZVW3RM5MYB8CMECWRCZYRE8QY
 'SP162ZM0G83Q728GKNTA4YCMZ3SKDYRR9VRRS450T
 'SP2T54E7ZF9PWF5T2PPKZ9Y91SVXHKMJAC2YR1PK2
 'SP1WPXA2P88VE2Y35X25SPY6XEKFHGMD9HPHNFMJS
 'SPKR4RE84RQE60ZDGX1W797CRT042Y6DY39MPZGA
 'SPX16TDB9179KY0PWTQYCKESCBGK9T5H9DVYMH44
 'SP7R7N3FCVXTJ1K7J86S94ZE4VQYCHZK4NTE9SZ6
 'SPM3D51TRZKFY1N7K6CGS3PR2JC93Z6ABF518Q6X
 'SP2YKZ736ENESVN0S0D45WTFWFJ1QEQND4HBJ48QJ
 'SP3XKSYJZKTRQE4RESG8Y9HCHW99TSGW6ST2S7JGA
 'SP1BBDPQZQG32AQ52NDCJD0Z9KN8X0XDZ7NKPZ54R
 'SP1EDNPMD2Q7X1WAVPEQH2BVK2MGJA8ABC68EVD03
 'SP3FSQ9MJ2NJMJFGSBX7Q8DRB0GNFPTWMTPM6RMF1
 'SP3B2XR6DBM4BMWXYGJT79187FZNX1BGFMNC0923S
 'SPJVMMHR45HM0Q2M8G8X4F7W5HBMEZ2A5PJYK0Q3
 'SP284BPJZJ9DV361T1A136KEH0085KQKS7YQD3S3V
 'SPS712GG50GS7J3AWY9J346ZDCFBNTXYGA58DVJK
 'SP1PX32190DQMA3VEW6HB3N78D5TCHMCSDYYER6XV
 'SP2E899VZ1P368BV2N1G52R5N5P8RJRNCYWRGCTF0
 'SP2Z5BDJMV1ACXJD03KQC0116RBST27VBKTS479WY
 'SP1F9621D5EGYK8PWQ2TTG6PFC3FNYY29ES5VAARW
 'SP2QW7P6S4RV4KTK1SKQVKA44Y3PY7PGZAVS99NSJ
 'SP2G61Z6F8XDYX4N15GB4FF101QPTVWNGB2HYME5X
 'SP25NZQJ0EBY7QRK9H9XW2MDAT5PENQ2JST67P4ZT
 'SP3PZF4X18YV6BHBSSFS7T1JEZ3VKPX1A8J0WVGKH
 'SP2BQG0YE12AEJ2SMXA01KQ96BYFNZZQG0QX5VNQ9
 'SP2THA4M6WGPM88V49RYBAG029TEPV1BRDAR9QB06
 'SP29EE186RPQG6WXBMP0QAX0XR5MPP18DBXM4453K
 'SP29GZMV1SDYEAYW2VWMHQ52CJ3GNWFBRM91DBFGA
 'SP1EWKJHKSAHT6HZPJTZRZ1YEJ5W1QH662E926NVB
 'SP1G32T8NT3K6S88C7FM1BE9HSCQ0W4BP3VAR03Z9
 'SP19AJF083JDBY103NCG3Z6BB6SR2JMEJ45CT3SH
 'SP20T5MV3699K1N2QW89P4VDMQ4ZV2AC1S0WD09AB
 'SP1WY797HNM6FV6PA2N4CQ594B150FXYAJTK9Z69H
 'SP1FHAGDPESAEFVZCNDJ4DZYV9ZRPB47HTQE1J3PX
 'SP1EGQS7HKW19VYDCFS8B0VYK6NY54FVBH45YR05E
 'SPHJC68KK4PAMH4P7YJ95W92ZZ95NJKVQXE10X20
 'SP5X1DSFS1VCGN0TGW76NZTR3N4CAQ5NF5W1ZRMX
 'SP3NCXQ25Y5N2X2J56X4J148FNXWPR339J3RH61B5
 'SP38NQK6SY5T9J0V28AVV9NDGJ2DYXCYQ4F5Y8MPQ
 'SP15NET02TBS36ZWJPC3Q0DNP0AESAEYHBRBDYABX
 'SP31SSW0E6MS8ABMTBTYWJNY7ZE70DVKYYEQW5CH2
 'SPQW6KN9ND73ATKBJ1BQDS608H7EWP6TN60625PR
 'SPB51186R8WZZBDJKC5EJDDWXQQJEWQ15DVQMFJC
 'SPBCG50PD48QK93WFTX8JY8E2DCZ1N83KKTAA15N
 'SP363P27XZHFKP345KJWW3ZTMHAY6Z09ZZJ8TWPX3
 'SP1D23WK7FC0KWTZ3N2NXVYFKB2EKEQN96W7448M5
 'SPDZHW3Y1DA8HZ42HW0A5XBTDVC40R5MW8DEV2H0
 'SPBREJJA99KMD37EQ0NTSR79NM03S0GHRRCB83WZ
 'SP1W1TQJ9ZNJX1D2GNWRYJTS32HB4QDH6BW6T9EW3
 'SP26WZFXCET1KZ4FKZ4NKGY1WB3KGB119BSD9S74V
 'SP36909N2KSHNG4M86FR3CEKRXK9J7CHX76NM793R
 'SP25X4N10G2N8TDS50SQJY72GFCMFKJG0Q19Y748S
 'SP1BB6516ZZSJDEK7JH30KHJP47HXW256JMGPVMGP
 'SP1DD3KW6HNXD9SCVRC68AGKQFE9WPQX1XB7PCKDW
 'SP2QFFTXKGC19PBAVKTPNHS7PZE5RJHRJ6B8EWDPF
 'SP3K7QAXR3NVR1VAHB6PC0SSWVECA14YFJTQ6PB3N
 'SP28EV55S7XXD7BYENFCV4HY6HENTR647T7TRF6KF
 'SP3KR41TTK97ATC2AWRPXV2N777YKCN2C8TARXXB8
 'SP11JNSS3X4Z13CMTX5ZX53925W91R1HX5XQ84J21
 'SP2V1XAMRZHJJ3AJES9NQJNPB083CP5WJ8Z0A9QBR
 'SP78QB7CZKYF549KMSSYVAPPZNFC0G8GBSYYF717
 'SP2ADCJ6606CFHERS3HKABWB6PF5XBANXBQ4GSE86
 'SP1AA1YQYNM5SA29XNJB01A880VAZ456H69MSR366
 'SP3KE2FXSNDF3K0HM7MWE0B0X8001VY6Z1C0N5VSV
 'SP1FHW3TM7DXM9FF5S46X1JTXNJ8WWHTXYGKN257D
 'SP376Y7METTJAT372GYDGD225YE20A01GAV7KJFKN
 'SP9MS5DCCWSVC7HTTQ54D5MNS2FR9YNJ0V0BJNN8
 'SP1PQ9BQWJ3SSDJX47T798JG459Y1MJWXA57FFS0D
 'SP11Q6XVWW91NQG0G1KZGFRVATZPZK2N78VNV52ZQ
 'SP17MA2G8RKVR3QHXGZ60V187DVVRT58Q35K91T3C
 'SPGZPVBKCH1ZV7R31ZW7E9R61E2CV7ABW0XGEJWP
 'SPVAQY2P22HPKFSAYHPYV14B82B772AYMPQMXK30
 'SP22AG163Q337WVNQ3KYY3DNKEA7C4Z1WWH22DNQ5
 'SP3Q4YSAXPGMQ5Y3SWB5M7NS5XF4TZWRXZ6JSD044
 'SPXZ5TX6R19NDAVVXNM5CR2R77MABNF32P6Q6BAD
 'SPPSGTT8H6JTWM3V2JGPSSFZEXE95XTSF160E2E0
 'SP3JXVWNAYWQWK8XW0V5B3DMGZK709805K9M1RFZ8
 'SP2P0GA04AC0QFYXNGR3414E4V7FXH0GMNWPC3QS1
))

(define-public (burn-mint)
  (begin
    (asserts! (var-get enabled) (err u10))
    (asserts! (is-eq deployer tx-sender) (err u11))
    (asserts! (not (var-get executed-burn-mint)) (err u12))
    ;; enable zststx access
    (try! (contract-call? .zwstx set-approved-contract (as-contract tx-sender) true))
    (try! (contract-call? .zwstx-v1 set-approved-contract (as-contract tx-sender) true))
    (try! (contract-call? .zwstx-v1-2-1 set-approved-contract (as-contract tx-sender) true))
    (try! (contract-call? .zwstx-v2-0 set-approved-contract (as-contract tx-sender) true))

    ;; burn/mint v2 to v3
    (try! (fold check-err (map consolidate-wstx-lambda holders) (ok true)))

    ;; disable access
    (try! (contract-call? .zwstx set-approved-contract (as-contract tx-sender) false))
    (try! (contract-call? .zwstx-v1 set-approved-contract (as-contract tx-sender) false))
    (try! (contract-call? .zwstx-v1-2-1 set-approved-contract (as-contract tx-sender) false))
    (try! (contract-call? .zwstx-v2-0 set-approved-contract (as-contract tx-sender) false))

    (var-set executed-burn-mint true)
    (ok true)
  )
)

(define-private (consolidate-wstx-lambda (account principal))
  (consolidate-wstx-balance-to-v3 account)
)

(define-private (check-err (result (response bool uint)) (prior (response bool uint)))
  (match prior ok-value result err-value (err err-value))
)

(define-private (consolidate-wstx-balance-to-v3 (account principal))
  (let (
    ;; burns old balances and mints to the latest version
    (v0-balance (unwrap-panic (contract-call? .zwstx get-principal-balance account)))
    (v1-balance (unwrap-panic (contract-call? .zwstx-v1 get-principal-balance account)))
    (v2-balance (unwrap-panic (contract-call? .zwstx-v1-2-1 get-principal-balance account)))
    )
    (if (> v0-balance u0)
      (begin
        (try! (contract-call? .zwstx burn v0-balance account))
        (try! (contract-call? .zwstx-v2-0 mint v0-balance account))
        true
      )
      ;; if doesn't have v0 balance, then check if has v1 balance
      (if (> v1-balance u0)
        (begin
          (try! (contract-call? .zwstx-v1 burn v1-balance account))
          (try! (contract-call? .zwstx-v2-0 mint v1-balance account))
          true
        )
        ;; if doesn't have v1 balance, then check if has v2 balance
        (if (> v2-balance u0)
          (begin
            (try! (contract-call? .zwstx-v1-2-1 burn v2-balance account))
            (try! (contract-call? .zwstx-v2-0 mint v2-balance account))
            true
          )
          false
        )
      )
    )
    (ok true)
  )
)

(define-read-only (can-execute)
  (begin
    (asserts! (not (var-get enabled)) (err u10))
    (ok (not (var-get enabled)))
  )
)


(define-public (disable)
  (begin
    (asserts! (is-eq deployer tx-sender) (err u11))
    (ok (var-set enabled false))
  )
)


```
