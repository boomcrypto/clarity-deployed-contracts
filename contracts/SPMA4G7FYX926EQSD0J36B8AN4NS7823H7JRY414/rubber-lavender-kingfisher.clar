(define-read-only (check-eligibility (wanted-btc-block uint) (stx-block-height uint)) 
  (let
    ( 
      (stx-tenure-btc-hash (get-tenure-info? burnchain-header-hash stx-block-height))
      (prev-stx-tenure-btc-hash (get-tenure-info? burnchain-header-hash (- stx-block-height u1)))
      (first-btc-block (find-first-btc-block-anchored-starting-with wanted-btc-block))
    )
    (if (is-eq stx-tenure-btc-hash prev-stx-tenure-btc-hash)
      false
      (if (not (is-eq stx-tenure-btc-hash (get-burn-block-info? header-hash first-btc-block))) 
        false
        true
      )
    )
  )
)

(define-read-only (find-first-btc-block-anchored-starting-with (btc-block-height uint)) 
  (if (is-some (get-burn-block-info? header-hash btc-block-height))
    btc-block-height
    (if (is-some (get-burn-block-info? header-hash (+ btc-block-height u1)))
      (+ btc-block-height u1)
      (if (is-some (get-burn-block-info? header-hash (+ btc-block-height u2)))
        (+ btc-block-height u2)
        (if (is-some (get-burn-block-info? header-hash (+ btc-block-height u3)))
          (+ btc-block-height u3)
          (if (is-some (get-burn-block-info? header-hash (+ btc-block-height u4)))
            (+ btc-block-height u4)
            (if (is-some (get-burn-block-info? header-hash (+ btc-block-height u5)))
              (+ btc-block-height u5)      
              (if (is-some (get-burn-block-info? header-hash (+ btc-block-height u6)))
                (+ btc-block-height u6)
                (if (is-some (get-burn-block-info? header-hash (+ btc-block-height u7)))
                  (+ btc-block-height u7)
                  (if (is-some (get-burn-block-info? header-hash (+ btc-block-height u8)))
                    (+ btc-block-height u8)
                    (if (is-some (get-burn-block-info? header-hash (+ btc-block-height u9)))
                      (+ btc-block-height u9)
                      (if (is-some (get-burn-block-info? header-hash (+ btc-block-height u10)))
                        (+ btc-block-height u10)
                        (- btc-block-height u1)
                      )
                    )
                  )
                )
              )
            )
          )
        )
      )
    )
  )
)
